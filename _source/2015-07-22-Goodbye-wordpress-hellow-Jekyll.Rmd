---
layout: post
title: "Wordpress에서 Jekyll로..."
date: 2015-07-22
categories: R
tags: [R, servr, knitr, Jekyll]
comments: true
---

```{r eval=TRUE, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  error = TRUE,
  tidy = FALSE,
  width = 60
)

options(digits = 3)
```

약 10년을 써오던 설치형 [워드프레스](http://wordpress.org)를 버리고 [Github Page](https://pages.github.com)에서 제공하는 [Jekyll](http://jekyllrb.com)기반의블로그로 이동하였다. 많은 이들이 그러하듯 나도 워드프레스의 무거움과 관리의 귀찮음이 워드프레스에서 Jekyll로 이동하는데 결정적인 몫을 하였다. 게다가 거의 모든글을 markdown으로 작성하고 있고 git도 매일같이 사용하는 툴이기에 이들에대한 학습시간이 불필요하다는 이점도 있고... 

Github Page와 Jekyll을 이용하여 블로깅을 하는 방법과 장점에 대해서는 인터넷에 잔뜩 널려있으니[^fn-1] 여기서는 자세한 설명을 생략하기로 하고 이 블로그의 주된 주제인 데이터 분석, 특히 R 코드 및 수식이 들어간 글을 쉽게 Jekyll 문법에 맞게 포스팅할 수 있는가 하는 방법에 대해 정리해보자.

이동 전까지는 R 코드가 포함된 모든글을 [RStudio](http://www.rstudio.com)에서 rmarkdown을 이용해 작성 -> html 변환 -> 워드프레스 에디터에서 최종편집하는 과정을 거쳤다. 하지만

* `.Rmd` 파일과 블로그에 올리는 최종글과 차이가 있다.
* 글을 수정하려면 다시 앞 과정을 반복해야한다. 
* 글의 버전 관리(특히 .Rmd 파일)가 어렵다.

는 불편함이 있었다. 

그동안 원래 글들을 Jekyll로 마이그레이션만 시켜 놓고 오랬동안 블로그를 방치하고 있었는데 얼마전 R의 `servr + knitr ` 페키지를 이용하여 로컬 Jekyll 사이트를 구축하는 [방법](http://yihui.name/knitr-jekyll/2014/09/jekyll-with-knitr.html)을 알게 되어 이를 이용한다. 

사용방법이 따로 있는 것이 아니라 두 패키지를 설치한 다음 

```{r eval = FALSE, prompt=TRUE}
install.packages(c("knitr", "servr"))
```

로컬 Jekyll 사이트를 가장 상위의 디렉토리를 작업디렉토리로 한 후 R 콘솔에서

```{r eval = FALSE, prompt=TRUE}
servr::jekyll()
```
을 실행하면 로컬 머신의 Jekyll 사이트를 빌드해 준다. 이때 함수 `jekyll`에 아무값도 지 정해 주지 않는다면 

1. 디폴트로 *_source* 디렉토리에 있는 `.Rmd` 파일을 `.md` 파일로 변환
2. 변환된 `.md` 파일을 *_post* 디렉토리로 이동
3. Jekyll 사이트 빌드

의 과정을 거치게 된다. 이 모든 과정이 오류없이 진행된다면 github pages에 commit 하면 블로그 포스팅이 완료된다.

일반적으로 Jekyll을 사용하는 많은 이들이 `redcarpet`을 markdown 엔진으로 사용하는데 포스트에 가끔 들어가는 [Mathjax](https://www.mathjax.org)을 이용한 `$$ 수식 $$`이 제대로 표시되지 않는 문제가 있다. 대안으로 `kramdown`을 사용하면 그 문제가 해결되는데 다만 세개의 backticks로 시작하는 코드 삽입을 할 수 없고 `{% highlight lang %} {% endhighlight %}`으로 코드의 시작과 끝을 알려 주어야한다. 친절하게도 이에대한 해결 방법도 제공해 주어서 다음과 같은 내용의 `build.R` 파일을 작성하여 로컬 Jekyll 사이트에 저장하고 `servr::jekyll()`을 실행하면 된다. 

```{r eval = FALSE}
## Serve Jekyll Websites with servr and knitr
## from http://yihui.name/knitr-jekyll/2014/09/jekyll-with-knitr.html

local({
  # fall back on '/' if baseurl is not specified
  baseurl = servr:::jekyll_config('.', 'baseurl', '/')
  knitr::opts_knit$set(base.url = baseurl)
  # fall back on 'kramdown' if markdown engine is not specified
  markdown = servr:::jekyll_config('.', 'markdown', 'kramdown')
  # see if we need to use the Jekyll render in knitr
  if (markdown == 'kramdown') {
    knitr::render_jekyll()
  } else knitr::render_markdown()

  # input/output filenames are passed as two additional arguments to Rscript
  a = commandArgs(TRUE)
  d = gsub('^_|[.][a-zA-Z]+$', '', a[1])
  knitr::opts_chunk$set(
    fig.path   = sprintf('figs/%s/', d),
    cache.path = sprintf('cache/%s/', d)
  )
  knitr::opts_knit$set(width = 70)
  knitr::knit(a[1], a[2], quiet = TRUE, encoding = 'UTF-8', envir = .GlobalEnv)
})
```

일단 틀은 만들어 놓았는데 언제나 고민이 되고 진행 속도가 느린건 안에 들어가는 내용이다. 다음 글은 언제 올릴지 기약 없지만 일단 여기까지...ㅎ

[^fn-1]: 추천링크-[난 10년된 워드프레스에서 Jekyll로 마이그레이션](http://ilmol.com/2015/01/워드프레스에서%20Jekyll로%20마이그레이션.html)